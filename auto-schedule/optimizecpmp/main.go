package main

import (
	"encoding/json"
	"fmt"
	"sort"

	"emcontroller/auto-schedule/algorithms"
	asmodel "emcontroller/auto-schedule/model"
)

const (
	cloudsJson string = `{"CLAAUDIAweifan":{"name":"CLAAUDIAweifan","type":"openstack","resources":{"limit":{"vcpu":20,"ram":512000,"vm":5,"volume":10,"storage":10000,"port":500},"inUse":{"vcpu":20,"ram":90112,"vm":5,"volume":5,"storage":5560,"port":11}},"netState":{"CLAAUDIAweifan":{"rtt":0.725},"NOKIA10":{"rtt":52.667},"NOKIA2":{"rtt":11.448},"NOKIA3":{"rtt":17.171},"NOKIA4":{"rtt":24.594},"NOKIA5":{"rtt":30.11},"NOKIA7":{"rtt":38.303},"NOKIA8":{"rtt":45.535}},"k8sNodes":[{"name":"claaudia-large-disk","residualResources":{"cpuCore":7,"memory":13721,"storage":3830}}]},"NOKIA10":{"name":"NOKIA10","type":"proxmox","resources":{"limit":{"vcpu":40,"ram":64288.671875,"vm":-1,"volume":-1,"storage":793.7522621154785,"port":-1},"inUse":{"vcpu":26,"ram":47104,"vm":-1,"volume":-1,"storage":699,"port":-1}},"netState":{"CLAAUDIAweifan":{"rtt":52.917},"NOKIA10":{"rtt":0.982},"NOKIA2":{"rtt":59.808},"NOKIA3":{"rtt":65.73},"NOKIA4":{"rtt":73.407},"NOKIA5":{"rtt":78.781},"NOKIA7":{"rtt":87.013},"NOKIA8":{"rtt":93.864}},"k8sNodes":null},"NOKIA2":{"name":"NOKIA2","type":"proxmox","resources":{"limit":{"vcpu":56,"ram":128796.75390625,"vm":-1,"volume":-1,"storage":831.012393951416,"port":-1},"inUse":{"vcpu":31,"ram":8192,"vm":-1,"volume":-1,"storage":60,"port":-1}},"netState":{"CLAAUDIAweifan":{"rtt":11.556},"NOKIA10":{"rtt":59.82},"NOKIA2":{"rtt":0.426},"NOKIA3":{"rtt":24.927},"NOKIA4":{"rtt":31.785},"NOKIA5":{"rtt":37.704},"NOKIA7":{"rtt":45.804},"NOKIA8":{"rtt":52.784}},"k8sNodes":null},"NOKIA3":{"name":"NOKIA3","type":"proxmox","resources":{"limit":{"vcpu":56,"ram":128796.75390625,"vm":-1,"volume":-1,"storage":831.012393951416,"port":-1},"inUse":{"vcpu":36,"ram":8192,"vm":-1,"volume":-1,"storage":60,"port":-1}},"netState":{"CLAAUDIAweifan":{"rtt":17.604},"NOKIA10":{"rtt":65.88},"NOKIA2":{"rtt":24.759},"NOKIA3":{"rtt":0.51},"NOKIA4":{"rtt":37.82},"NOKIA5":{"rtt":44.164},"NOKIA7":{"rtt":51.837},"NOKIA8":{"rtt":58.825}},"k8sNodes":null},"NOKIA4":{"name":"NOKIA4","type":"proxmox","resources":{"limit":{"vcpu":56,"ram":128796.75390625,"vm":-1,"volume":-1,"storage":1296.5185890197754,"port":-1},"inUse":{"vcpu":28,"ram":49152,"vm":-1,"volume":-1,"storage":340,"port":-1}},"netState":{"CLAAUDIAweifan":{"rtt":24.577},"NOKIA10":{"rtt":72.89},"NOKIA2":{"rtt":32.089},"NOKIA3":{"rtt":39.029},"NOKIA4":{"rtt":0.746},"NOKIA5":{"rtt":50.802},"NOKIA7":{"rtt":58.877},"NOKIA8":{"rtt":66.1}},"k8sNodes":null},"NOKIA5":{"name":"NOKIA5","type":"proxmox","resources":{"limit":{"vcpu":40,"ram":64288.671875,"vm":-1,"volume":-1,"storage":793.7522621154785,"port":-1},"inUse":{"vcpu":15,"ram":8192,"vm":-1,"volume":-1,"storage":60,"port":-1}},"netState":{"CLAAUDIAweifan":{"rtt":30.233},"NOKIA10":{"rtt":78.748},"NOKIA2":{"rtt":37.735},"NOKIA3":{"rtt":43.666},"NOKIA4":{"rtt":50.777},"NOKIA5":{"rtt":0.744},"NOKIA7":{"rtt":64.767},"NOKIA8":{"rtt":72.142}},"k8sNodes":null},"NOKIA7":{"name":"NOKIA7","type":"proxmox","resources":{"limit":{"vcpu":56,"ram":128796.75390625,"vm":-1,"volume":-1,"storage":831.012393951416,"port":-1},"inUse":{"vcpu":42,"ram":69228,"vm":-1,"volume":-1,"storage":188,"port":-1}},"netState":{"CLAAUDIAweifan":{"rtt":38.795},"NOKIA10":{"rtt":87.132},"NOKIA2":{"rtt":45.81},"NOKIA3":{"rtt":51.851},"NOKIA4":{"rtt":58.901},"NOKIA5":{"rtt":64.831},"NOKIA7":{"rtt":0.989},"NOKIA8":{"rtt":80.053}},"k8sNodes":null},"NOKIA8":{"name":"NOKIA8","type":"proxmox","resources":{"limit":{"vcpu":56,"ram":128796.75390625,"vm":-1,"volume":-1,"storage":831.012393951416,"port":-1},"inUse":{"vcpu":30,"ram":32768,"vm":-1,"volume":-1,"storage":460,"port":-1}},"netState":{"CLAAUDIAweifan":{"rtt":46.944},"NOKIA10":{"rtt":93.984},"NOKIA2":{"rtt":52.817},"NOKIA3":{"rtt":58.805},"NOKIA4":{"rtt":65.898},"NOKIA5":{"rtt":71.794},"NOKIA7":{"rtt":80.406},"NOKIA8":{"rtt":1.083}},"k8sNodes":[{"name":"nokia8-test","residualResources":{"cpuCore":5,"memory":6148,"storage":139}}]}}`

	appsJson string = `{"expt-app-0":{"name":"expt-app-0","priority":5,"resources":{"cpuCore":2,"memory":1024,"storage":2},"dependencies":[{"appName":"expt-app-46"}]},"expt-app-1":{"name":"expt-app-1","priority":4,"resources":{"cpuCore":4,"memory":8192,"storage":500},"dependencies":[{"appName":"expt-app-93"}]},"expt-app-10":{"name":"expt-app-10","priority":3,"resources":{"cpuCore":2,"memory":2048,"storage":1},"dependencies":[{"appName":"expt-app-13"}]},"expt-app-11":{"name":"expt-app-11","priority":5,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-0"},{"appName":"expt-app-83"}]},"expt-app-12":{"name":"expt-app-12","priority":6,"resources":{"cpuCore":2,"memory":1024,"storage":2},"dependencies":[{"appName":"expt-app-46"}]},"expt-app-13":{"name":"expt-app-13","priority":4,"resources":{"cpuCore":12,"memory":24576,"storage":0},"dependencies":[{"appName":"expt-app-33"},{"appName":"expt-app-48"}]},"expt-app-14":{"name":"expt-app-14","priority":3,"resources":{"cpuCore":8,"memory":8192,"storage":155},"dependencies":[{"appName":"expt-app-29"}]},"expt-app-15":{"name":"expt-app-15","priority":10,"resources":{"cpuCore":1,"memory":256,"storage":6},"dependencies":[{"appName":"expt-app-71"}]},"expt-app-16":{"name":"expt-app-16","priority":9,"resources":{"cpuCore":12,"memory":24576,"storage":0},"dependencies":[{"appName":"expt-app-23"}]},"expt-app-17":{"name":"expt-app-17","priority":1,"resources":{"cpuCore":2,"memory":1024,"storage":4},"dependencies":[{"appName":"expt-app-68"}]},"expt-app-18":{"name":"expt-app-18","priority":5,"resources":{"cpuCore":12,"memory":24576,"storage":0},"dependencies":[{"appName":"expt-app-39"}]},"expt-app-19":{"name":"expt-app-19","priority":3,"resources":{"cpuCore":4,"memory":2048,"storage":3},"dependencies":[{"appName":"expt-app-13"}]},"expt-app-2":{"name":"expt-app-2","priority":9,"resources":{"cpuCore":4,"memory":8192,"storage":500},"dependencies":[{"appName":"expt-app-77"}]},"expt-app-20":{"name":"expt-app-20","priority":4,"resources":{"cpuCore":2,"memory":1024,"storage":2},"dependencies":[{"appName":"expt-app-33"},{"appName":"expt-app-46"}]},"expt-app-21":{"name":"expt-app-21","priority":2,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-86"},{"appName":"expt-app-89"}]},"expt-app-22":{"name":"expt-app-22","priority":4,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-88"},{"appName":"expt-app-0"}]},"expt-app-23":{"name":"expt-app-23","priority":9,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":null},"expt-app-24":{"name":"expt-app-24","priority":2,"resources":{"cpuCore":4,"memory":2048,"storage":3},"dependencies":[{"appName":"expt-app-35"},{"appName":"expt-app-93"}]},"expt-app-25":{"name":"expt-app-25","priority":10,"resources":{"cpuCore":4,"memory":2048,"storage":3},"dependencies":null},"expt-app-26":{"name":"expt-app-26","priority":9,"resources":{"cpuCore":4,"memory":2048,"storage":3},"dependencies":[{"appName":"expt-app-2"}]},"expt-app-27":{"name":"expt-app-27","priority":2,"resources":{"cpuCore":1,"memory":500,"storage":0},"dependencies":[{"appName":"expt-app-13"}]},"expt-app-28":{"name":"expt-app-28","priority":2,"resources":{"cpuCore":8,"memory":8192,"storage":155},"dependencies":[{"appName":"expt-app-21"},{"appName":"expt-app-30"}]},"expt-app-29":{"name":"expt-app-29","priority":8,"resources":{"cpuCore":12,"memory":24576,"storage":0},"dependencies":[{"appName":"expt-app-23"}]},"expt-app-3":{"name":"expt-app-3","priority":1,"resources":{"cpuCore":4,"memory":8192,"storage":500},"dependencies":[{"appName":"expt-app-98"}]},"expt-app-30":{"name":"expt-app-30","priority":8,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-75"}]},"expt-app-31":{"name":"expt-app-31","priority":3,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-55"},{"appName":"expt-app-94"}]},"expt-app-32":{"name":"expt-app-32","priority":3,"resources":{"cpuCore":4,"memory":8192,"storage":500},"dependencies":[{"appName":"expt-app-72"},{"appName":"expt-app-23"}]},"expt-app-33":{"name":"expt-app-33","priority":5,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-5"},{"appName":"expt-app-2"}]},"expt-app-34":{"name":"expt-app-34","priority":3,"resources":{"cpuCore":2,"memory":2048,"storage":1},"dependencies":[{"appName":"expt-app-45"}]},"expt-app-35":{"name":"expt-app-35","priority":2,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-60"}]},"expt-app-36":{"name":"expt-app-36","priority":8,"resources":{"cpuCore":4,"memory":2048,"storage":3},"dependencies":[{"appName":"expt-app-26"},{"appName":"expt-app-49"}]},"expt-app-37":{"name":"expt-app-37","priority":6,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-65"}]},"expt-app-38":{"name":"expt-app-38","priority":1,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-54"},{"appName":"expt-app-5"}]},"expt-app-39":{"name":"expt-app-39","priority":7,"resources":{"cpuCore":1,"memory":256,"storage":6},"dependencies":[{"appName":"expt-app-83"}]},"expt-app-4":{"name":"expt-app-4","priority":5,"resources":{"cpuCore":4,"memory":15360,"storage":30},"dependencies":[{"appName":"expt-app-12"}]},"expt-app-40":{"name":"expt-app-40","priority":8,"resources":{"cpuCore":4,"memory":15360,"storage":30},"dependencies":[{"appName":"expt-app-79"}]},"expt-app-41":{"name":"expt-app-41","priority":6,"resources":{"cpuCore":4,"memory":15360,"storage":30},"dependencies":[{"appName":"expt-app-74"}]},"expt-app-42":{"name":"expt-app-42","priority":10,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-15"}]},"expt-app-43":{"name":"expt-app-43","priority":5,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-76"},{"appName":"expt-app-37"}]},"expt-app-44":{"name":"expt-app-44","priority":2,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-60"},{"appName":"expt-app-43"}]},"expt-app-45":{"name":"expt-app-45","priority":3,"resources":{"cpuCore":1,"memory":500,"storage":0},"dependencies":[{"appName":"expt-app-31"}]},"expt-app-46":{"name":"expt-app-46","priority":6,"resources":{"cpuCore":2,"memory":2048,"storage":1},"dependencies":[{"appName":"expt-app-52"},{"appName":"expt-app-8"}]},"expt-app-47":{"name":"expt-app-47","priority":5,"resources":{"cpuCore":4,"memory":2048,"storage":3},"dependencies":[{"appName":"expt-app-25"}]},"expt-app-48":{"name":"expt-app-48","priority":8,"resources":{"cpuCore":2,"memory":1024,"storage":2},"dependencies":[{"appName":"expt-app-80"}]},"expt-app-49":{"name":"expt-app-49","priority":9,"resources":{"cpuCore":4,"memory":15360,"storage":30},"dependencies":[{"appName":"expt-app-91"}]},"expt-app-5":{"name":"expt-app-5","priority":7,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-84"}]},"expt-app-50":{"name":"expt-app-50","priority":2,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-32"}]},"expt-app-51":{"name":"expt-app-51","priority":4,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-46"}]},"expt-app-52":{"name":"expt-app-52","priority":8,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-36"}]},"expt-app-53":{"name":"expt-app-53","priority":6,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-73"}]},"expt-app-54":{"name":"expt-app-54","priority":2,"resources":{"cpuCore":2,"memory":2048,"storage":1},"dependencies":[{"appName":"expt-app-20"},{"appName":"expt-app-62"}]},"expt-app-55":{"name":"expt-app-55","priority":4,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-56"}]},"expt-app-56":{"name":"expt-app-56","priority":5,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-94"}]},"expt-app-57":{"name":"expt-app-57","priority":3,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-18"}]},"expt-app-58":{"name":"expt-app-58","priority":6,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-48"}]},"expt-app-59":{"name":"expt-app-59","priority":5,"resources":{"cpuCore":2,"memory":1024,"storage":4},"dependencies":[{"appName":"expt-app-93"},{"appName":"expt-app-26"}]},"expt-app-6":{"name":"expt-app-6","priority":10,"resources":{"cpuCore":1,"memory":256,"storage":6},"dependencies":[{"appName":"expt-app-74"}]},"expt-app-60":{"name":"expt-app-60","priority":3,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-19"},{"appName":"expt-app-0"}]},"expt-app-61":{"name":"expt-app-61","priority":10,"resources":{"cpuCore":4,"memory":2048,"storage":3},"dependencies":null},"expt-app-62":{"name":"expt-app-62","priority":10,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":null},"expt-app-63":{"name":"expt-app-63","priority":10,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-74"}]},"expt-app-64":{"name":"expt-app-64","priority":7,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-40"}]},"expt-app-65":{"name":"expt-app-65","priority":6,"resources":{"cpuCore":1,"memory":500,"storage":0},"dependencies":[{"appName":"expt-app-83"},{"appName":"expt-app-48"}]},"expt-app-66":{"name":"expt-app-66","priority":6,"resources":{"cpuCore":1,"memory":500,"storage":0},"dependencies":[{"appName":"expt-app-84"},{"appName":"expt-app-25"}]},"expt-app-67":{"name":"expt-app-67","priority":9,"resources":{"cpuCore":4,"memory":15360,"storage":30},"dependencies":[{"appName":"expt-app-82"}]},"expt-app-68":{"name":"expt-app-68","priority":2,"resources":{"cpuCore":2,"memory":8192,"storage":128},"dependencies":[{"appName":"expt-app-27"}]},"expt-app-69":{"name":"expt-app-69","priority":4,"resources":{"cpuCore":1,"memory":256,"storage":6},"dependencies":[{"appName":"expt-app-47"}]},"expt-app-7":{"name":"expt-app-7","priority":5,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-78"}]},"expt-app-70":{"name":"expt-app-70","priority":5,"resources":{"cpuCore":1,"memory":256,"storage":6},"dependencies":[{"appName":"expt-app-18"},{"appName":"expt-app-0"}]},"expt-app-71":{"name":"expt-app-71","priority":10,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":null},"expt-app-72":{"name":"expt-app-72","priority":3,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-55"}]},"expt-app-73":{"name":"expt-app-73","priority":6,"resources":{"cpuCore":1,"memory":256,"storage":6},"dependencies":[{"appName":"expt-app-78"}]},"expt-app-74":{"name":"expt-app-74","priority":10,"resources":{"cpuCore":2,"memory":2048,"storage":80},"dependencies":null},"expt-app-75":{"name":"expt-app-75","priority":9,"resources":{"cpuCore":4,"memory":8192,"storage":500},"dependencies":null},"expt-app-76":{"name":"expt-app-76","priority":5,"resources":{"cpuCore":12,"memory":24576,"storage":0},"dependencies":[{"appName":"expt-app-18"}]},"expt-app-77":{"name":"expt-app-77","priority":9,"resources":{"cpuCore":4,"memory":15360,"storage":30},"dependencies":[{"appName":"expt-app-67"}]},"expt-app-78":{"name":"expt-app-78","priority":9,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-9"}]},"expt-app-79":{"name":"expt-app-79","priority":9,"resources":{"cpuCore":12,"memory":24576,"storage":0},"dependencies":[{"appName":"expt-app-23"}]},"expt-app-8":{"name":"expt-app-8","priority":9,"resources":{"cpuCore":1,"memory":256,"storage":6},"dependencies":[{"appName":"expt-app-82"}]},"expt-app-80":{"name":"expt-app-80","priority":8,"resources":{"cpuCore":2,"memory":1024,"storage":2},"dependencies":[{"appName":"expt-app-82"}]},"expt-app-81":{"name":"expt-app-81","priority":1,"resources":{"cpuCore":2,"memory":8192,"storage":128},"dependencies":[{"appName":"expt-app-10"}]},"expt-app-82":{"name":"expt-app-82","priority":9,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-6"}]},"expt-app-83":{"name":"expt-app-83","priority":7,"resources":{"cpuCore":4,"memory":8192,"storage":500},"dependencies":[{"appName":"expt-app-64"}]},"expt-app-84":{"name":"expt-app-84","priority":8,"resources":{"cpuCore":2,"memory":2048,"storage":80},"dependencies":[{"appName":"expt-app-87"}]},"expt-app-85":{"name":"expt-app-85","priority":4,"resources":{"cpuCore":4,"memory":8192,"storage":500},"dependencies":[{"appName":"expt-app-7"},{"appName":"expt-app-52"}]},"expt-app-86":{"name":"expt-app-86","priority":4,"resources":{"cpuCore":1,"memory":500,"storage":0},"dependencies":[{"appName":"expt-app-7"}]},"expt-app-87":{"name":"expt-app-87","priority":9,"resources":{"cpuCore":4,"memory":2048,"storage":3},"dependencies":[{"appName":"expt-app-15"}]},"expt-app-88":{"name":"expt-app-88","priority":5,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-97"}]},"expt-app-89":{"name":"expt-app-89","priority":9,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-42"}]},"expt-app-9":{"name":"expt-app-9","priority":9,"resources":{"cpuCore":2,"memory":2048,"storage":1},"dependencies":[{"appName":"expt-app-74"}]},"expt-app-90":{"name":"expt-app-90","priority":2,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-44"}]},"expt-app-91":{"name":"expt-app-91","priority":10,"resources":{"cpuCore":4,"memory":15360,"storage":30},"dependencies":null},"expt-app-92":{"name":"expt-app-92","priority":1,"resources":{"cpuCore":2,"memory":1024,"storage":8},"dependencies":[{"appName":"expt-app-27"}]},"expt-app-93":{"name":"expt-app-93","priority":5,"resources":{"cpuCore":4,"memory":8192,"storage":500},"dependencies":[{"appName":"expt-app-18"}]},"expt-app-94":{"name":"expt-app-94","priority":7,"resources":{"cpuCore":4,"memory":4096,"storage":20},"dependencies":[{"appName":"expt-app-82"}]},"expt-app-95":{"name":"expt-app-95","priority":3,"resources":{"cpuCore":2,"memory":2048,"storage":80},"dependencies":[{"appName":"expt-app-22"}]},"expt-app-96":{"name":"expt-app-96","priority":9,"resources":{"cpuCore":4,"memory":15360,"storage":30},"dependencies":[{"appName":"expt-app-75"}]},"expt-app-97":{"name":"expt-app-97","priority":5,"resources":{"cpuCore":2,"memory":1024,"storage":4},"dependencies":[{"appName":"expt-app-0"}]},"expt-app-98":{"name":"expt-app-98","priority":1,"resources":{"cpuCore":1,"memory":500,"storage":0},"dependencies":[{"appName":"expt-app-31"}]},"expt-app-99":{"name":"expt-app-99","priority":1,"resources":{"cpuCore":4,"memory":16384,"storage":100},"dependencies":[{"appName":"expt-app-68"}]}}`

	appsOrderJson string = `["expt-app-0","expt-app-1","expt-app-10","expt-app-11","expt-app-12","expt-app-13","expt-app-14","expt-app-15","expt-app-16","expt-app-17","expt-app-18","expt-app-19","expt-app-2","expt-app-20","expt-app-21","expt-app-22","expt-app-23","expt-app-24","expt-app-25","expt-app-26","expt-app-27","expt-app-28","expt-app-29","expt-app-3","expt-app-30","expt-app-31","expt-app-32","expt-app-33","expt-app-34","expt-app-35","expt-app-36","expt-app-37","expt-app-38","expt-app-39","expt-app-4","expt-app-40","expt-app-41","expt-app-42","expt-app-43","expt-app-44","expt-app-45","expt-app-46","expt-app-47","expt-app-48","expt-app-49","expt-app-5","expt-app-50","expt-app-51","expt-app-52","expt-app-53","expt-app-54","expt-app-55","expt-app-56","expt-app-57","expt-app-58","expt-app-59","expt-app-6","expt-app-60","expt-app-61","expt-app-62","expt-app-63","expt-app-64","expt-app-65","expt-app-66","expt-app-67","expt-app-68","expt-app-69","expt-app-7","expt-app-70","expt-app-71","expt-app-72","expt-app-73","expt-app-74","expt-app-75","expt-app-76","expt-app-77","expt-app-78","expt-app-79","expt-app-8","expt-app-80","expt-app-81","expt-app-82","expt-app-83","expt-app-84","expt-app-85","expt-app-86","expt-app-87","expt-app-88","expt-app-89","expt-app-9","expt-app-90","expt-app-91","expt-app-92","expt-app-93","expt-app-94","expt-app-95","expt-app-96","expt-app-97","expt-app-98","expt-app-99"]`
)

var (
	clouds    map[string]asmodel.Cloud
	apps      map[string]asmodel.Application
	appsOrder []string
)

func init() {
	if err := json.Unmarshal([]byte(cloudsJson), &clouds); err != nil {
		panic("error json.Unmarshal clouds: " + err.Error())
	}
	if err := json.Unmarshal([]byte(appsJson), &apps); err != nil {
		panic("error json.Unmarshal clouds: " + err.Error())
	}
	if err := json.Unmarshal([]byte(appsOrderJson), &appsOrder); err != nil {
		panic("error json.Unmarshal clouds: " + err.Error())
	}
}

type cpmpRecord struct {
	cp      float64
	mp      float64
	fitness float64
}

type cpmpRecordSlice []cpmpRecord

func (cmrs cpmpRecordSlice) Len() int {
	return len(cmrs)
}

func (cmrs cpmpRecordSlice) Swap(i, j int) {
	cmrs[i], cmrs[j] = cmrs[j], cmrs[i]
}

func (cmrs cpmpRecordSlice) Less(i, j int) bool {
	return cmrs[i].fitness < cmrs[j].fitness
}

func main() {
	var testRecords []cpmpRecord

	var samplesPerScenario int = 10

	for cp := 0.0; cp <= 1.0; cp += 0.1 {
		for mp := 0.001; mp <= 0.02; mp += 0.001 {

			var fitnessSum float64 = 0
			for i := 0; i < samplesPerScenario; i++ {
				fmt.Printf("testing cp: %g, mp: %g, round %d\n", cp, mp, i)
				thisFitness := testParameters(cp, mp)
				fitnessSum += thisFitness
			}

			testRecords = append(testRecords, cpmpRecord{
				cp:      cp,
				mp:      mp,
				fitness: fitnessSum / float64(samplesPerScenario),
			})

		}
	}

	sort.Sort(cpmpRecordSlice(testRecords))
	for i := 0; i < len(testRecords); i++ {
		fmt.Printf("cp: %g, mp: %g, fitness: %g\n", testRecords[i].cp, testRecords[i].mp, testRecords[i].fitness)
	}
}

func testParameters(crossoverProbability float64, mutationProbability float64) float64 {
	mcssgaInstance := algorithms.NewMcssga(200, 5000, crossoverProbability, mutationProbability, 200, algorithms.DefaultExpAppCompuTimeOneCpu)
	solution, err := mcssgaInstance.Schedule(clouds, apps, appsOrder)
	if err != nil {
		panic(fmt.Sprintf("mcssgaInstance.Schedule, crossoverProbability: %g, mutationProbability: %g, error: %s", crossoverProbability, mutationProbability, err.Error()))
	}
	return mcssgaInstance.Fitness(clouds, apps, solution)
}
